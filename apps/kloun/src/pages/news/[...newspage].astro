---
export const prerender = false;
 
import { sql } from "../../../data/hasura";
import CardNews from "../../components/CardNews.astro";
import Pagination from "../../components/Pagination.astro";
import Layout from "../../layouts/Layout.astro";
const { newspage } = Astro.params as { newspage: string };

const pagenum = newspage ? Number(newspage) : 1;

const skip = pagenum * 30 - 30;
 
const x1 = sql(`select nid,title,date,image,id from newsbg where cat = 'NewsBG' order by id desc limit 30  offset ${skip}`)
const x2 = sql(`select total_count from aggregator where cat_with_suffix = 'NewsBG' limit 1`)
 const resp = await Promise.all([x1, x2]).then((results) => ({
   newsbg: results[0],
   aggregator: results[1],
 }));
 
 console.log(resp);
 
---

<Layout
  title={`Новини от на страница ${pagenum}`}
  description={`Новини  `}
  hideFooter={true}
>
  <div class="flex flex-wrap gap-3">
    {
      resp.newsbg.map(
        ({
          nid,
          title,
          date,
          key,
          image,
          id
        }: {
          nid: string;
          title: string;
          date: string;
          key: string;
          image: string;
          id:number;
        }) => (
          <CardNews title={title} img={image} date={date} key={key} nid={nid} id={id} />
        )
      )
    }
  </div>
  <Pagination
    items={resp.aggregator[0].total_count}
    currentPage={pagenum}
    pageSize={30}
    prefix="/news/"
  />  
</Layout>
